{"ast":null,"code":"import axios from \"axios/index\";\nimport ReservationPreview from \"@/components/Client/ClientPage/components/ClientProfile/ClientReservations/ReservationPreview\";\nimport ReservationCancellation from \"@/components/Client/ClientPage/components/ClientProfile/ClientReservations/ReservationCancellation\"; //import {useStore} from \"vuex\";\n\nexport default {\n  name: \"ClientReservations\",\n  props: [\"reservations\"],\n  components: {\n    ReservationPreview,\n    ReservationCancellation\n  },\n\n  data() {\n    return {\n      images: [],\n      sortedReservations: []\n    };\n  },\n\n  computed: {},\n  methods: {\n    isFeeNull(reservation) {\n      return reservation.rentalObject.cancellationFee !== null;\n    },\n\n    calculateTotal(reservation) {\n      let days = this.getNumberOfDays(reservation);\n      let services = this.calculateAdditionalServices(reservation);\n      let price = reservation.price;\n\n      if (reservation.specialOffer !== null) {\n        return days * price / 100 * (100 - reservation.specialOffer.discount);\n      }\n\n      return days * price + services;\n    },\n\n    getNumberOfDays(reservation) {\n      let initDate = reservation.initDate,\n          termDate = reservation.termDate;\n      let date1 = new Date(initDate),\n          date2 = new Date(termDate);\n      date1.setHours(0, 0, 0);\n      date2.setHours(0, 0, 0);\n      let timeDiff = date2.getTime() - date1.getTime();\n      let daysDiff = timeDiff / (1000 * 3600 * 24);\n      return daysDiff + 1;\n    },\n\n    calculateAdditionalServices(reservation) {\n      let services = reservation.additionalServices,\n          totalServices = 0;\n\n      for (let i = 0; i < services.length; i++) totalServices += services[i].price;\n\n      return totalServices;\n    },\n\n    getDateSpan(reservation) {\n      let initDate = reservation.initDate,\n          termDate = reservation.termDate;\n      let date1 = new Date(initDate),\n          date2 = new Date(termDate); // date1.setHours(0, 0, 0);\n      // date2.setHours(0, 0, 0);\n\n      let dateDisplay = date1.getDate() + '.' + (date1.getMonth() + 1) + '.' + date1.getFullYear() + '.';\n      if (date1.getFullYear() !== date2.getFullYear() || date1.getMonth() !== date2.getMonth() || date1.getDate() !== date2.getDate()) dateDisplay += ' - ' + date2.getDate() + '.' + (date2.getMonth() + 1) + '.' + date2.getFullYear() + '.';\n      return dateDisplay;\n    },\n\n    setRentalIdAndType(reservation) {\n      this.$store.dispatch(\"rentalId\", reservation.rentalObject.id);\n      this.$store.dispatch(\"rentalType\", reservation.rentalObject.rentalObjectType);\n    },\n\n    getPath(reservation) {\n      return \"/client/RentalProfile/\" + reservation.rentalObject.rentalObjectType + \"-\" + reservation.rentalObject.id;\n    }\n\n  },\n\n  mounted() {\n    this.sortedReservations = this.reservations;\n    this.sortedReservations = this.sortedReservations.sort((a, b) => new Date(b.initDate) < new Date(a.initDate) ? 1 : -1); //if(!this.reservations) return;\n\n    for (let i = 0; i < this.reservations.length; i++) {\n      if (!this.reservations[i].rentalObject.displayPhoto.photo) {\n        this.images[i] = null;\n        continue;\n      }\n\n      axios.get(\"/Photos/\", {\n        headers: {\n          Authorization: \"Bearer \" + this.$store.getters.access_token\n        },\n        params: {\n          path: this.reservations[i].rentalObject.displayPhoto.photo\n        },\n        responseType: \"blob\"\n      }).then(response => {\n        this.images[i] = URL.createObjectURL(response.data);\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n  }\n\n};","map":{"version":3,"mappings":"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","names":["axios","ReservationPreview","ReservationCancellation","name","props","components","data","images","sortedReservations","computed","methods","isFeeNull","reservation","rentalObject","cancellationFee","calculateTotal","days","getNumberOfDays","services","calculateAdditionalServices","price","specialOffer","discount","initDate","termDate","date1","Date","date2","setHours","timeDiff","getTime","daysDiff","additionalServices","totalServices","i","length","getDateSpan","dateDisplay","getDate","getMonth","getFullYear","setRentalIdAndType","$store","dispatch","id","rentalObjectType","getPath","mounted","reservations","sort","a","b","displayPhoto","photo","get","headers","Authorization","getters","access_token","params","path","responseType","then","response","URL","createObjectURL","catch","error","console","log"],"sourceRoot":"","sources":["C:\\Users\\Sa≈°ka\\Downloads\\ISA_MRS\\isa_mrs_projekat_front\\src\\components\\Client\\ClientPage\\components\\ClientProfile\\ClientReservations\\ClientUpcomingReservations\\ClientReservations.vue"],"sourcesContent":["<template>\r\n  <div v-for=\"(reservation, i) in this.sortedReservations\" :key=\"i\" class=\"card reservation mb-3\">\r\n    <div class=\"row\">\r\n      <div class=\"col-md-4\" >\r\n        <router-link :to=\"getPath(reservation)\" class=\"link\" @click=\"setRentalIdAndType(reservation)\">\r\n          <img class=\"rentalPhoto\" :src=\"images[i]\" alt=\"\"/>\r\n        </router-link>\r\n      </div>\r\n      <div class=\"col-md-4\">\r\n        <div class=\"row\">\r\n          <div class=\"rentalObjectName align-items-center text-start\" style=\"display: flex;\">\r\n            <div>\r\n              <h1 class=\"display-6 me-1 card-title cut-text\">{{ reservation.rentalObject.name }}</h1>\r\n            </div>\r\n            <hr>\r\n          </div>\r\n        </div>\r\n        <div class=\"row\">\r\n          <p class=\"h4\" ><strong style=\"color:#008970;\">Date:</strong> {{  getDateSpan(reservation) }}</p>\r\n        </div>\r\n        <div class=\"row\">\r\n          <p class=\"h4\"><strong style=\"color:#008970;\">Total:</strong> ${{  calculateTotal(reservation) }}</p>\r\n        </div>\r\n      </div>\r\n      <div class=\"col-md-4 p-5 d-flex flex-grow-1 justify-content-center align-items-center\" style=\"height: 20vh;\">\r\n        <div style=\"width: 100%;\">\r\n          <div class=\"row\">\r\n            <button class=\"w-100 btn mb-2\" style=\"font-weight: 500; color: white;\" data-bs-toggle=\"modal\"\r\n                    :data-bs-target=\"'#bill-'+reservation.id\">\r\n              Reservation Preview\r\n            </button>\r\n            <ReservationPreview :services=\"reservation.additionalServices\"\r\n                                :days=\"getNumberOfDays(reservation)\"\r\n                                :price=\"reservation.price\"\r\n                                :total=\"calculateTotal(reservation)\"\r\n                                :id=\"reservation.id\"\r\n                                :specialOffer=\"reservation.specialOffer\"/>\r\n          </div>\r\n          <div class=\"row\">\r\n            <button class=\"w-100 btn\" style=\"background-color:#e23c52; font-weight: 500; color: white;\"\r\n                    data-bs-toggle=\"modal\" :data-bs-target=\"'#cancel-'+reservation.id\">\r\n              Cancel Reservation\r\n            </button>\r\n            <ReservationCancellation :id=\"reservation.id\"\r\n                                     :cancellationFee=\"reservation.rentalObject.cancellationFee\"\r\n                                     :reservationStartDate=\"reservation.initDate\"\r\n                                     :reservationId=\"reservation.id\"\r\n                                     :total=\"calculateTotal(reservation)\"/>\r\n          </div>\r\n        </div>\r\n\r\n\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\n\r\nimport axios from \"axios/index\";\r\nimport ReservationPreview\r\n  from \"@/components/Client/ClientPage/components/ClientProfile/ClientReservations/ReservationPreview\";\r\nimport ReservationCancellation\r\n  from \"@/components/Client/ClientPage/components/ClientProfile/ClientReservations/ReservationCancellation\";\r\n//import {useStore} from \"vuex\";\r\n\r\nexport default {\r\n  name: \"ClientReservations\",\r\n  props: [\"reservations\"],\r\n  components: {ReservationPreview, ReservationCancellation},\r\n  data() {\r\n    return {\r\n      images: [],\r\n      sortedReservations: [],\r\n    }\r\n  },\r\n  computed: {\r\n\r\n  },\r\n  methods: {\r\n    isFeeNull(reservation) {\r\n      return reservation.rentalObject.cancellationFee !== null;\r\n    },\r\n    calculateTotal(reservation) {\r\n      let days = this.getNumberOfDays(reservation);\r\n      let services = this.calculateAdditionalServices(reservation);\r\n      let price = reservation.price;\r\n      if(reservation.specialOffer !== null) {\r\n        return (days*price)/100 * (100-reservation.specialOffer.discount);\r\n      }\r\n      return days*price+services;\r\n    },\r\n    getNumberOfDays(reservation) {\r\n      let initDate = reservation.initDate, termDate = reservation.termDate;\r\n      let date1 = new Date(initDate), date2 = new Date(termDate);\r\n      date1.setHours(0, 0, 0);\r\n      date2.setHours(0, 0, 0);\r\n      let timeDiff = date2.getTime() - date1.getTime();\r\n      let daysDiff = timeDiff / (1000 * 3600 * 24);\r\n      return daysDiff + 1;\r\n    },\r\n    calculateAdditionalServices(reservation) {\r\n      let services = reservation.additionalServices, totalServices = 0;\r\n      for(let i=0; i<services.length; i++) totalServices += services[i].price;\r\n      return totalServices;\r\n    },\r\n    getDateSpan(reservation) {\r\n      let initDate = reservation.initDate, termDate = reservation.termDate;\r\n      let date1 = new Date(initDate), date2 = new Date(termDate);\r\n      // date1.setHours(0, 0, 0);\r\n      // date2.setHours(0, 0, 0);\r\n      let dateDisplay = date1.getDate() + '.' + (date1.getMonth() + 1) + '.' +  date1.getFullYear() + '.';\r\n      if(date1.getFullYear() !== date2.getFullYear() || date1.getMonth() !== date2.getMonth() || date1.getDate() !== date2.getDate())\r\n        dateDisplay += ' - ' + date2.getDate() + '.' + (date2.getMonth() + 1) + '.' +  date2.getFullYear() + '.';\r\n      return dateDisplay;\r\n    },\r\n    setRentalIdAndType(reservation) {\r\n      this.$store.dispatch(\"rentalId\", reservation.rentalObject.id);\r\n      this.$store.dispatch(\"rentalType\", reservation.rentalObject.rentalObjectType);\r\n    },\r\n    getPath(reservation) {\r\n      return \"/client/RentalProfile/\" + reservation.rentalObject.rentalObjectType + \"-\"\r\n          + reservation.rentalObject.id;\r\n    },\r\n  },\r\n  mounted() {\r\n    this.sortedReservations = this.reservations;\r\n    this.sortedReservations = this.sortedReservations.sort((a, b) => new Date(b.initDate) < new Date(a.initDate) ? 1: -1);\r\n    //if(!this.reservations) return;\r\n    for (let i=0; i < this.reservations.length; i++) {\r\n      if(!this.reservations[i].rentalObject.displayPhoto.photo) { this.images[i] = null; continue; }\r\n      axios.get(\"/Photos/\", {\r\n        headers: {\r\n          Authorization: \"Bearer \" + this.$store.getters.access_token,\r\n        },\r\n        params: {\r\n          path: this.reservations[i].rentalObject.displayPhoto.photo,\r\n        },\r\n        responseType: \"blob\"\r\n      })\r\n      .then(response => {\r\n        this.images[i] = URL.createObjectURL(response.data);\r\n      })\r\n      .catch((error) => {\r\n        console.log(error);\r\n      });\r\n    }\r\n  },\r\n}\r\n</script>\r\n\r\n<style scoped>\r\nhr {\r\n  flex-grow: 1;\r\n}\r\n.cut-text {\r\n  width: 100%;\r\n  display: -webkit-box;\r\n  -webkit-line-clamp: 1;\r\n  -webkit-box-orient: vertical;\r\n  overflow: hidden;\r\n}\r\ndiv.rentalObjectName {\r\n  display: flex;\r\n}\r\ndiv.reservation {\r\n  box-shadow: 0.1rem 0.1rem 0.4rem rgb(0 0 0 / 15%);\r\n  background-color: #ffffff;\r\n}\r\ndiv.reservation:hover {\r\n  padding: 3px;\r\n}\r\nimg.rentalPhoto {\r\n  height: 20vh;\r\n  width: 100%;\r\n  border-radius: 1rem;\r\n  object-fit: cover;\r\n  object-position: center;\r\n}\r\n.card {\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: fit-content;\r\n  min-width: 0;\r\n  word-wrap: break-word;\r\n  background-color: #fff;\r\n  background-clip: border-box;\r\n  border: none;\r\n  box-shadow: 0 0.5rem 1rem rgb(0 0 0 / 15%);\r\n  border-radius: 1rem;\r\n}\r\n.card-header:first-child {\r\n  border-radius: calc(1rem - 1px) calc(1rem - 1px) 0 0;\r\n}\r\n.card-header {\r\n  position: relative;\r\n  padding: 2rem 2rem;\r\n  border-bottom: none;\r\n  background-color: inherit;\r\n  box-shadow: 0 0.125rem 0.25rem rgb(0 0 0 / 8%);\r\n  z-index: 2;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}