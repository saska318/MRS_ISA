{"ast":null,"code":"import { FontAwesomeIcon } from \"@fortawesome/vue-fontawesome\";\nimport { library } from \"@fortawesome/fontawesome-svg-core\";\nimport { faEye, faTrash, faFilter, faX } from \"@fortawesome/free-solid-svg-icons\";\nimport axios from \"axios\";\nimport { useStore } from \"vuex\";\nimport { toggleLoading, toggleProcessing } from \"@/components/state\";\nlibrary.add(faEye, faTrash, faFilter, faX);\nexport default {\n  name: \"AdminRentalsView\",\n  components: {\n    FontAwesomeIcon\n  },\n\n  data() {\n    return {\n      rentalObjects: [],\n      currentPage: 0,\n      totalPages: null,\n      pageSize: 10,\n      filterType: null,\n      filterActive: false,\n      imageUrls: [],\n      changedRentals: []\n    };\n  },\n\n  mounted() {\n    toggleLoading();\n    const store = useStore();\n    axios.get(\"/RentalObjects/getRentalObjectsPage\", {\n      headers: {\n        Authorization: \"Bearer \" + store.getters.access_token\n      },\n      params: {\n        page: this.currentPage,\n        pageSize: this.pageSize\n      }\n    }).then(response => {\n      this.rentalObjects = response.data.content;\n      this.currentPage = response.data.currentPage;\n      this.totalPages = response.data.pages;\n      this.rentalObjects.forEach(rentalObject => {\n        if (rentalObject.photos.length > 0) {\n          const index = this.rentalObjects.indexOf(rentalObject);\n          this.loadImage(rentalObject.photos[0].photo, index);\n        }\n      });\n      toggleLoading();\n    }).catch(() => {\n      this.$notify({\n        title: \"Server error\",\n        text: \"Server is currently off. Please try again later...\",\n        type: \"error\"\n      });\n      toggleLoading();\n    });\n  },\n\n  methods: {\n    saveChanges() {\n      toggleProcessing();\n      let ids = this.changedRentalsIds;\n      let lwc = {\n        list: ids\n      };\n      axios.put(\"/RentalObjects/multipleRentalsStatusChange\", lwc, {\n        headers: {\n          Authorization: \"Bearer \" + this.$store.state.access_token\n        }\n      }).then(response => {\n        let message = \"You have successfully changed status for rental objects:\";\n        response.data.forEach(rentalObject => {\n          message += \" \" + rentalObject.name + \",\";\n        });\n        message = message.slice(0, -1);\n        message += \".\";\n        this.$notify({\n          title: \"Status Change Successful\",\n          text: message,\n          type: \"success\"\n        });\n        this.changedRentals = [];\n        toggleProcessing();\n      }).catch(() => {\n        this.$notify({\n          title: \"Server error\",\n          text: \"Something went wrong. Please try again later...\",\n          type: \"error\"\n        });\n        toggleProcessing();\n      });\n    },\n\n    changeStatus(rentalObject) {\n      let index = this.changedRentals.findIndex(element => element.id === rentalObject.id);\n\n      if (index > -1) {\n        this.changedRentals.splice(index, 1);\n      } else {\n        this.changedRentals.push(rentalObject);\n      }\n    },\n\n    loadImage(name, index) {\n      axios.get(\"/Photos/\", {\n        headers: {\n          Authorization: \"Bearer \" + this.$store.getters.access_token\n        },\n        params: {\n          path: name\n        },\n        responseType: \"blob\"\n      }).then(response => {\n        this.imageUrls[index] = URL.createObjectURL(response.data);\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n\n    filterButtonClicked() {\n      if (this.filterActive) {\n        this.filterType = null;\n        this.filterActive = !this.filterActive;\n        this.refreshPage();\n      } else if (this.filterType !== null) {\n        this.filterActive = !this.filterActive;\n        this.refreshPage();\n      }\n    },\n\n    rentalObjectType(rentalObject) {\n      if (rentalObject.rentalObjectType === \"Adventure\") {\n        return \"Adventure\";\n      } else if (rentalObject.rentalObjectType === \"VacationRental\") {\n        return \"Rental House\";\n      } else {\n        return rentalObject.rentalObjectType;\n      }\n    },\n\n    previousPage() {\n      this.currentPage -= 1;\n      this.refreshPage();\n    },\n\n    nextPage() {\n      this.currentPage += 1;\n      this.refreshPage();\n    },\n\n    numberedPage(buttonNumber) {\n      if (buttonNumber === 1) {\n        this.currentPage = this.button1Content - 1;\n      } else if (buttonNumber === 2) {\n        this.currentPage = this.button2Content - 1;\n      } else if (buttonNumber === 3) {\n        this.currentPage = this.button3Content - 1;\n      }\n\n      this.refreshPage();\n    },\n\n    refreshPage() {\n      let params;\n      let url;\n      toggleProcessing();\n\n      if (this.filterType !== null) {\n        params = {\n          page: this.currentPage,\n          pageSize: this.pageSize,\n          filter: this.filterType\n        };\n        url = \"/RentalObjects/getRentalObjectsFilterPage\";\n      } else {\n        params = {\n          page: this.currentPage,\n          pageSize: this.pageSize\n        };\n        url = \"/RentalObjects/getRentalObjectsPage\";\n      }\n\n      axios.get(url, {\n        headers: {\n          Authorization: \"Bearer \" + this.$store.getters.access_token\n        },\n        params\n      }).then(response => {\n        this.rentalObjects = response.data.content;\n        this.changedRentals.forEach(rentalObject => {\n          this.rentalObjects.forEach(rentalObject1 => {\n            if (rentalObject.id === rentalObject1.id && rentalObject.isActive !== rentalObject1.isActive) rentalObject1.isActive = rentalObject.isActive;\n          });\n        });\n        this.currentPage = response.data.currentPage;\n        this.totalPages = response.data.pages;\n        this.rentalObjects.forEach(rentalObject => {\n          if (rentalObject.photos.length > 0) {\n            const index = this.rentalObjects.indexOf(rentalObject);\n            this.loadImage(rentalObject.photos[0].photo, index);\n          }\n        });\n        toggleProcessing();\n      }).catch(() => {\n        this.$notify({\n          title: \"Server error\",\n          text: \"Server is currently off. Please try again later...\",\n          type: \"error\"\n        });\n        toggleProcessing();\n      });\n    }\n\n  },\n  computed: {\n    changedRentalsIds() {\n      let ids = [];\n      this.changedRentals.forEach(rentalObject => {\n        ids.push(rentalObject.id);\n      });\n      return ids;\n    },\n\n    hasChanged() {\n      return this.changedRentals.length > 0;\n    },\n\n    button1Content() {\n      return this.currentPage === 0 ? this.currentPage + 1 : this.totalPages - this.currentPage === 1 ? this.currentPage - 1 : this.currentPage;\n    },\n\n    button2Content() {\n      return this.currentPage === 0 ? this.currentPage + 2 : this.totalPages - this.currentPage === 1 ? this.currentPage : this.currentPage + 1;\n    },\n\n    button3Content() {\n      return this.currentPage === 0 ? this.currentPage + 3 : this.totalPages - this.currentPage === 1 ? this.currentPage + 1 : this.currentPage + 2;\n    },\n\n    modalMessage() {\n      let numberOfDeletedRentals = this.numberOfDeletedRentals;\n      let numberOfActivatedRentals = this.numberOfActivatedRentals;\n      let deleteMessage = \"\";\n      let activateMessage = \"\";\n\n      if (numberOfDeletedRentals > 1) {\n        deleteMessage = \"Do you want to delete rental objects:\";\n      } else if (numberOfDeletedRentals === 1) {\n        deleteMessage = \"Do you want to delete rental object:\";\n      }\n\n      if (numberOfActivatedRentals > 1) {\n        activateMessage = \"Do you want to activate rental objects:\";\n      } else if (numberOfActivatedRentals === 1) {\n        activateMessage = \"Do you want to activate rental object:\";\n      }\n\n      this.changedRentals.forEach(rentalObject => {\n        if (!rentalObject.isActive) {\n          deleteMessage += \" \" + rentalObject.name + \",\\n\";\n        } else {\n          activateMessage += \" \" + rentalObject.name + \",\\n\";\n        }\n      });\n\n      if (numberOfDeletedRentals > 0) {\n        deleteMessage = deleteMessage.slice(0, -2);\n        deleteMessage += \"?\";\n      }\n\n      if (numberOfActivatedRentals > 0) {\n        activateMessage = activateMessage.slice(0, -2);\n        activateMessage += \"?\";\n      }\n\n      return deleteMessage + \"\\n\" + activateMessage;\n    },\n\n    numberOfDeletedRentals() {\n      let counter = 0;\n      this.changedRentals.forEach(rentalObject => {\n        if (!rentalObject.isActive) {\n          counter += 1;\n        }\n      });\n      return counter;\n    },\n\n    numberOfActivatedRentals() {\n      let counter = 0;\n      this.changedRentals.forEach(rentalObject => {\n        if (rentalObject.isActive) {\n          counter += 1;\n        }\n      });\n      return counter;\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["FontAwesomeIcon","library","faEye","faTrash","faFilter","faX","axios","useStore","toggleLoading","toggleProcessing","add","name","components","data","rentalObjects","currentPage","totalPages","pageSize","filterType","filterActive","imageUrls","changedRentals","mounted","store","get","headers","Authorization","getters","access_token","params","page","then","response","content","pages","forEach","rentalObject","photos","length","index","indexOf","loadImage","photo","catch","$notify","title","text","type","methods","saveChanges","ids","changedRentalsIds","lwc","list","put","$store","state","message","slice","changeStatus","findIndex","element","id","splice","push","path","responseType","URL","createObjectURL","error","console","log","filterButtonClicked","refreshPage","rentalObjectType","previousPage","nextPage","numberedPage","buttonNumber","button1Content","button2Content","button3Content","url","filter","rentalObject1","isActive","computed","hasChanged","modalMessage","numberOfDeletedRentals","numberOfActivatedRentals","deleteMessage","activateMessage","counter"],"sourceRoot":"","sources":["C:\\Users\\Sa≈°ka\\Downloads\\ISA_MRS\\isa_mrs_projekat_front\\src\\components\\Administrator\\AdminPage\\components\\AdminMainViews\\AdminRentalsView.vue"],"sourcesContent":["<template>\r\n  <div class=\"row\">\r\n    <div class=\"col-1\"></div>\r\n    <div class=\"col-10 pt-5 mb-5\">\r\n      <div class=\"container-fluid pe-0 ps-0 me-0 ms-0\">\r\n        <div class=\"align-items-center\">\r\n          <div class=\"row main-col\">\r\n            <div class=\"col d-flex justify-content-start ps-0 ms-0 me-0 pe-0\">\r\n              <div class=\"col-sm-10 col-md-5 col-lg-3 col-xl-3 mb-1\">\r\n                <div class=\"d-flex flex-row\">\r\n                  <select class=\"form-control me-1\" v-model=\"filterType\" id=\"Type\">\r\n                    <option value=\"VacationRental\">Rental House</option>\r\n                    <option value=\"Boat\">Boat</option>\r\n                    <option value=\"Adventure\">Adventure</option>\r\n                  </select>\r\n                  <button @click=\"filterButtonClicked\" class=\"btn rounded\" :class=\"filterActive?'btn-red':''\" :disabled=\"filterType===null\"><font-awesome-icon :icon=\"filterActive?'x':'filter'\"></font-awesome-icon></button>\r\n                </div>\r\n              </div>\r\n              <div class=\"col mb-1\">\r\n                <div class=\"d-flex flex-row justify-content-end\">\r\n                  <button v-if=\"hasChanged\" class=\"btn btn-red me-1\" data-bs-toggle=\"modal\" data-bs-target=\"#confirmationDialog\">\r\n                    Save Changes\r\n                  </button>\r\n                </div>\r\n                <div class=\"modal fade\" id=\"confirmationDialog\" tabindex=\"-1\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\r\n                  <div class=\"modal-dialog\">\r\n                    <div class=\"modal-content\">\r\n                      <div class=\"modal-header\">\r\n                        <h5 class=\"modal-title\" id=\"exampleModalLabel\">Rental Objects' Status Change</h5>\r\n                        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n                      </div>\r\n                      <div class=\"modal-body\">\r\n                        {{modalMessage}}\r\n                      </div>\r\n                      <div class=\"modal-footer\">\r\n                        <button type=\"button\" class=\"btn btn-red\" style=\"margin-right: 2vh;\" data-bs-dismiss=\"modal\">No</button>\r\n                        <button type=\"button\" class=\"btn\" @click=\"saveChanges\" data-bs-dismiss=\"modal\">Yes</button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"row main-col text-center header rounded mb-3\">\r\n            <table>\r\n              <thead>\r\n              <tr>\r\n                <th></th>\r\n                <th>Name</th>\r\n                <th>Owner</th>\r\n                <th>Rental Object Type</th>\r\n                <th></th>\r\n                <th>Active</th>\r\n              </tr>\r\n              </thead>\r\n              <tbody>\r\n              <tr class=\"p-1\" v-for=\"(rentalObject, index) in this.rentalObjects\" :key=\"index\" :class=\"index%2!==0?'odd':'even'\" @change=\"filterActive=false\">\r\n                <td class=\"col-1\">\r\n                  <img v-if=\"rentalObject.photos.length !== 0\" :src=\"imageUrls[index]\" style=\"height: 6vh;width: 6vh; object-fit: cover; object-position: center;\" class=\"img-fluid rounded border-1\" alt=\"\">\r\n                  <font-awesome-icon v-else icon=\"user\" class=\"img-fluid rounded border-1\" style=\"height: 3vh\"></font-awesome-icon>\r\n                </td>\r\n                <td>\r\n                  <router-link class=\"profile-link\" :to=\"'/admin/' + rentalObject.rentalObjectType + '-' + rentalObject.id\">{{rentalObject.name}}</router-link>\r\n                </td>\r\n                <td>\r\n                  <router-link class=\"profile-link\" :to=\"'/admin/user/' + rentalObject.rentalObjectOwner.id\">{{rentalObject.rentalObjectOwner.name + \" \" + rentalObject.rentalObjectOwner.surname}}</router-link>\r\n                </td>\r\n                <td>\r\n                  {{this.rentalObjectType(rentalObject)}}\r\n                </td>\r\n                <td>\r\n                  <button :id=\"index\" class=\"eye-btn border-0 text-decoration-none\" type=\"button\" data-bs-toggle=\"modal\" :data-bs-target=\"'#profileModal' + index\">\r\n                    <font-awesome-icon class=\"text-decoration-underline\" icon=\"eye\"></font-awesome-icon>\r\n                  </button>\r\n                  <div class=\"modal fade\" :id=\"'profileModal' + index\" tabindex=\"-1\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\r\n                    <div class=\"modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg\">\r\n                      <div class=\"modal-content\">\r\n                        <div class=\"modal-header\">\r\n                          <h5 class=\"modal-title\">{{rentalObjectType(rentalObject)}} Profile</h5>\r\n                          <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n                        </div>\r\n                        <div class=\"modal-body\">\r\n                          <div class=\"row justify-content-center\">\r\n                            <div class=\"row\">\r\n                              <div class=\"col me-lg-3 me-md-2\">\r\n                                <div class=\"row text-center\">\r\n                                  <img v-if=\"rentalObject.photos.length !== 0\" :src=\"imageUrls[index]\" class=\"img-fluid rounded p-0\" alt=\"\">\r\n                                  <font-awesome-icon v-else icon=\"user\" class=\"img-fluid rounded p-0\" style=\"background-color: #B0B8B4FF; color: white\"></font-awesome-icon>\r\n                                </div>\r\n                              </div>\r\n                              <div class=\"col\">\r\n                                <div class=\"row text-center\">\r\n                                  <div class=\"container-fluid rounded\" style=\"border: 1px solid #008970; color: #008970\" >\r\n                                    <h5>{{rentalObject.name}}</h5>\r\n                                    <hr>\r\n                                    <div class=\"row pb-5\">\r\n                                      <div class=\"col text-start\">\r\n                                        <h6>Price: <span style=\"color: black\">{{rentalObject.price}}$</span></h6>\r\n                                        <h6>Description: <span style=\"color: black\">{{rentalObject.description}}</span></h6>\r\n                                        <h6>Address: <span style=\"color: black\">{{rentalObject.address.street + \" \" + rentalObject.address.number + \", \" + rentalObject.address.city + \", \" + rentalObject.address.country}}</span></h6>\r\n                                        <h6>Owner: <span style=\"color: black\">{{rentalObject.rentalObjectOwner.name + \" \" + rentalObject.rentalObjectOwner.surname + \"(\" + rentalObject.rentalObjectOwner.phone + \")\"}}</span></h6>\r\n                                        <h6>Activity:\r\n                                          <input v-if=\"rentalObject.isActive\" class=\"form-check-input\" type=\"checkbox\" checked disabled>\r\n                                          <input v-else class=\"form-check-input\" type=\"checkbox\" disabled></h6>\r\n                                      </div>\r\n                                    </div>\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </td>\r\n                <td>\r\n                  <input class=\"form-check-input\" type=\"checkbox\" :value=\"!rentalObject.isActive\" v-model=\"rentalObject.isActive\" @change=\"changeStatus(rentalObject)\" :disabled=\"!rentalObject.isDeletable\">\r\n                </td>\r\n              </tr>\r\n              </tbody>\r\n            </table>\r\n            <nav aria-label=\"Page navigation\">\r\n              <ul class=\"pagination justify-content-center mt-3\">\r\n                <li class=\"page-item\" v-if=\"totalPages > 1\"><button class=\"page-link\" :disabled=\"currentPage===0\" @click=\"previousPage\">Previous</button></li>\r\n                <li class=\"page-item mt-auto me-1 ms-1\" v-if=\"currentPage > 1 && totalPages > 3\">...</li>\r\n                <li class=\"page-item\"><button class=\"page-link\" :disabled=\"currentPage === 0\" @click=\"numberedPage(1)\">{{button1Content}}</button></li>\r\n                <li class=\"page-item\" v-if=\"totalPages > 1\"><button class=\"page-link\" :disabled=\"currentPage !== 0 && totalPages - currentPage > 1\" @click=\"numberedPage(2)\">{{button2Content}}</button></li>\r\n                <li class=\"page-item\" v-if=\"totalPages > 2\"><button class=\"page-link\" :disabled=\"totalPages - currentPage === 1\" @click=\"numberedPage(3)\">{{button3Content}}</button></li>\r\n                <li class=\"page-item mt-auto me-1 ms-1\" v-if=\"totalPages - currentPage > 1 && totalPages > 3 && button3Content !== totalPages\">...</li>\r\n                <li class=\"page-item\" v-if=\"totalPages > 1\"><button class=\"page-link\" :disabled=\"totalPages - currentPage === 1\" @click=\"nextPage\">Next</button></li>\r\n              </ul>\r\n            </nav>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"col-1\"></div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {FontAwesomeIcon} from \"@fortawesome/vue-fontawesome\";\r\nimport { library } from \"@fortawesome/fontawesome-svg-core\";\r\nimport {faEye, faTrash, faFilter, faX} from \"@fortawesome/free-solid-svg-icons\";\r\nimport axios from \"axios\";\r\nimport {useStore} from \"vuex\";\r\nimport {toggleLoading, toggleProcessing} from \"@/components/state\";\r\n\r\nlibrary.add(faEye, faTrash, faFilter, faX);\r\n\r\nexport default {\r\n  name: \"AdminRentalsView\",\r\n  components: {FontAwesomeIcon},\r\n  data() {\r\n    return {\r\n      rentalObjects: [],\r\n      currentPage: 0,\r\n      totalPages: null,\r\n      pageSize: 10,\r\n      filterType: null,\r\n      filterActive: false,\r\n      imageUrls: [],\r\n      changedRentals: []\r\n    }\r\n  },\r\n  mounted() {\r\n    toggleLoading();\r\n    const store = useStore();\r\n    axios.get(\"/RentalObjects/getRentalObjectsPage\", {headers: {\r\n        Authorization: \"Bearer \" + store.getters.access_token,\r\n      },\r\n      params: {\r\n        page: this.currentPage,\r\n        pageSize: this.pageSize\r\n      }\r\n    })\r\n        .then(response => {\r\n          this.rentalObjects = response.data.content;\r\n          this.currentPage = response.data.currentPage;\r\n          this.totalPages = response.data.pages;\r\n          this.rentalObjects.forEach(rentalObject => {\r\n            if (rentalObject.photos.length > 0) {\r\n              const index = this.rentalObjects.indexOf(rentalObject);\r\n              this.loadImage(rentalObject.photos[0].photo, index);\r\n            }\r\n          })\r\n          toggleLoading();\r\n        })\r\n        .catch(() =>{\r\n          this.$notify({\r\n            title: \"Server error\",\r\n            text: \"Server is currently off. Please try again later...\",\r\n            type: \"error\"\r\n          });\r\n          toggleLoading();\r\n        });\r\n  },\r\n  methods: {\r\n    saveChanges() {\r\n      toggleProcessing();\r\n      let ids = this.changedRentalsIds;\r\n      let lwc = {list: ids};\r\n      axios.put(\"/RentalObjects/multipleRentalsStatusChange\",\r\n          lwc,\r\n          {headers: {\r\n              Authorization: \"Bearer \" + this.$store.state.access_token,\r\n            }\r\n          })\r\n          .then((response) => {\r\n            let message = \"You have successfully changed status for rental objects:\";\r\n            response.data.forEach((rentalObject) => {message += \" \" + rentalObject.name + \",\"});\r\n            message = message.slice(0, -1);\r\n            message += \".\";\r\n            this.$notify({\r\n              title: \"Status Change Successful\",\r\n              text: message,\r\n              type: \"success\"\r\n            });\r\n            this.changedRentals = [];\r\n            toggleProcessing();\r\n          })\r\n          .catch(() =>{\r\n            this.$notify({\r\n              title: \"Server error\",\r\n              text: \"Something went wrong. Please try again later...\",\r\n              type: \"error\"\r\n            });\r\n            toggleProcessing();\r\n          })\r\n    },\r\n    changeStatus(rentalObject) {\r\n      let index = this.changedRentals.findIndex(element => element.id === rentalObject.id);\r\n      if (index > -1) {\r\n        this.changedRentals.splice(index, 1);\r\n      } else {\r\n        this.changedRentals.push(rentalObject);\r\n      }\r\n    },\r\n    loadImage(name, index) {\r\n      axios.get(\"/Photos/\", {headers: {\r\n          Authorization: \"Bearer \" + this.$store.getters.access_token,\r\n        },\r\n        params: {\r\n          path: name,\r\n        },\r\n        responseType: \"blob\"\r\n      })\r\n      .then(response => {\r\n        this.imageUrls[index] = URL.createObjectURL(response.data);\r\n      })\r\n      .catch((error) =>{\r\n        console.log(error);\r\n      });\r\n    },\r\n    filterButtonClicked() {\r\n      if (this.filterActive) {\r\n        this.filterType = null;\r\n        this.filterActive = !this.filterActive;\r\n        this.refreshPage();\r\n      } else if (this.filterType !== null) {\r\n        this.filterActive = !this.filterActive;\r\n        this.refreshPage();\r\n      }\r\n    },\r\n    rentalObjectType(rentalObject) {\r\n      if (rentalObject.rentalObjectType === \"Adventure\") {\r\n        return \"Adventure\";\r\n      } else if (rentalObject.rentalObjectType === \"VacationRental\") {\r\n        return \"Rental House\";\r\n      } else {\r\n        return rentalObject.rentalObjectType;\r\n      }\r\n    },\r\n    previousPage() {\r\n      this.currentPage -= 1;\r\n      this.refreshPage();\r\n    },\r\n    nextPage() {\r\n      this.currentPage += 1;\r\n      this.refreshPage();\r\n    },\r\n    numberedPage(buttonNumber) {\r\n      if (buttonNumber === 1) {\r\n        this.currentPage = this.button1Content - 1;\r\n      } else if (buttonNumber === 2) {\r\n        this.currentPage = this.button2Content - 1;\r\n      } else if (buttonNumber === 3) {\r\n        this.currentPage = this.button3Content - 1;\r\n      }\r\n      this.refreshPage();\r\n    },\r\n    refreshPage() {\r\n      let params;\r\n      let url;\r\n      toggleProcessing();\r\n      if (this.filterType !== null) {\r\n        params = {\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize,\r\n          filter: this.filterType\r\n        };\r\n        url = \"/RentalObjects/getRentalObjectsFilterPage\";\r\n      } else {\r\n        params = {\r\n          page: this.currentPage,\r\n          pageSize: this.pageSize\r\n        };\r\n        url = \"/RentalObjects/getRentalObjectsPage\";\r\n      }\r\n      axios.get(url, {headers: {\r\n          Authorization: \"Bearer \" + this.$store.getters.access_token,\r\n        },\r\n        params\r\n      })\r\n          .then(response => {\r\n            this.rentalObjects = response.data.content;\r\n            this.changedRentals.forEach(rentalObject =>\r\n              { this.rentalObjects.forEach( rentalObject1 =>\r\n                { if (rentalObject.id === rentalObject1.id && rentalObject.isActive !== rentalObject1.isActive)\r\n                  rentalObject1.isActive = rentalObject.isActive;\r\n                });\r\n              });\r\n            this.currentPage = response.data.currentPage;\r\n            this.totalPages = response.data.pages;\r\n            this.rentalObjects.forEach(rentalObject => {\r\n              if (rentalObject.photos.length > 0) {\r\n                const index = this.rentalObjects.indexOf(rentalObject);\r\n                this.loadImage(rentalObject.photos[0].photo, index);\r\n              }\r\n            })\r\n            toggleProcessing();\r\n          })\r\n          .catch(() =>{\r\n            this.$notify({\r\n              title: \"Server error\",\r\n              text: \"Server is currently off. Please try again later...\",\r\n              type: \"error\"\r\n            });\r\n            toggleProcessing();\r\n          });\r\n    }\r\n  },\r\n  computed: {\r\n    changedRentalsIds() {\r\n      let ids = [];\r\n      this.changedRentals.forEach(rentalObject => {ids.push(rentalObject.id)});\r\n      return ids;\r\n    },\r\n    hasChanged() {\r\n      return this.changedRentals.length > 0;\r\n    },\r\n    button1Content() {\r\n      return this.currentPage === 0 ? this.currentPage+1: this.totalPages - this.currentPage === 1 ? this.currentPage - 1 : this.currentPage;\r\n    },\r\n    button2Content() {\r\n      return this.currentPage === 0 ? this.currentPage+2: this.totalPages - this.currentPage === 1 ? this.currentPage : this.currentPage+1;\r\n    },\r\n    button3Content() {\r\n      return this.currentPage === 0 ? this.currentPage+3: this.totalPages - this.currentPage === 1 ? this.currentPage + 1 : this.currentPage+2;\r\n    },\r\n    modalMessage() {\r\n      let numberOfDeletedRentals = this.numberOfDeletedRentals;\r\n      let numberOfActivatedRentals = this.numberOfActivatedRentals;\r\n      let deleteMessage = \"\";\r\n      let activateMessage = \"\";\r\n      if (numberOfDeletedRentals > 1) {\r\n        deleteMessage = \"Do you want to delete rental objects:\";\r\n      } else if (numberOfDeletedRentals === 1) {\r\n        deleteMessage = \"Do you want to delete rental object:\";\r\n      }\r\n      if (numberOfActivatedRentals > 1) {\r\n        activateMessage = \"Do you want to activate rental objects:\";\r\n      } else if (numberOfActivatedRentals === 1) {\r\n        activateMessage = \"Do you want to activate rental object:\";\r\n      }\r\n      this.changedRentals.forEach(rentalObject => {\r\n        if (!rentalObject.isActive) {\r\n          deleteMessage += \" \" + rentalObject.name + \",\\n\";\r\n        } else {\r\n          activateMessage += \" \" + rentalObject.name + \",\\n\";\r\n        }\r\n      });\r\n      if (numberOfDeletedRentals > 0) {\r\n        deleteMessage = deleteMessage.slice(0, -2);\r\n        deleteMessage += \"?\";\r\n      }\r\n      if (numberOfActivatedRentals > 0) {\r\n        activateMessage = activateMessage.slice(0, -2);\r\n        activateMessage += \"?\";\r\n      }\r\n      return deleteMessage + \"\\n\" + activateMessage;\r\n    },\r\n    numberOfDeletedRentals() {\r\n      let counter = 0;\r\n      this.changedRentals.forEach(rentalObject => {\r\n        if (!rentalObject.isActive) {\r\n          counter += 1;\r\n        }\r\n      });\r\n      return counter;\r\n    },\r\n    numberOfActivatedRentals() {\r\n      let counter = 0;\r\n      this.changedRentals.forEach(rentalObject => {\r\n        if (rentalObject.isActive) {\r\n          counter += 1;\r\n        }\r\n      });\r\n      return counter;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n  .profile-link {\r\n    color: #008970;\r\n  }\r\n\r\n  .rounded-circle {\r\n    background-color:  rgba(176, 184, 180);\r\n    color: white;\r\n    padding: 10px;\r\n  }\r\n</style>"]},"metadata":{},"sourceType":"module"}